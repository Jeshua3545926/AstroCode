<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Código</title>
    <!--<script src="AstroWeb.js"></script>-->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="./node_modules/monaco-editor/min/vs/editor/editor.main.css">
    <link rel="stylesheet" href="copilot.css">
    <link rel="stylesheet" href="AstroWeb.css">
    <style>
        #monaco-editor {
            width: 100%;
            height: 100%;
            min-height: 200px;
            position: relative;
            overflow: hidden;
            display: block !important;
            visibility: visible !important; 
            opacity: 1 !important;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body>
    <div class="editor">
        <!-- Barra de actividad (izquierda) -->
        <div class="activity-bar">
            <div class="activity-bar-top">
                <button class="activity-button active" data-view="explorer" title="Explorador">
                    <i class="ri-file-list-line"></i>
                </button>
                <button class="activity-button" data-view="search" title="Buscar">
                    <i class="ri-search-line"></i>
                </button>
                <button class="activity-button" data-view="git" title="Control de código fuente">
                    <i class="ri-git-branch-line"></i>
                </button>
                <button class="activity-button" data-view="debug" title="Depurar">
                    <i class="ri-bug-line"></i>
                </button>
                <button class="activity-button" data-view="extensions" title="Extensiones">
                    <i class="ri-apps-line"></i>
                </button>
                <button class="activity-button" data-view="gemini" title="Gemini">
                    <i class="ri-gemini-line"></i>
                </button>
                <button class="activity-button" data-view="copilot" title="Copilot">
                    <i class="ri-copilot-line"></i>
                </button>
                <button class="activity-button" data-view="chatgpt" title="Chat Gpt">
                    <i class="ri-openai-fill"></i>
                </button>
                <button class="activity-button" data-view="flowchart" title="Diagrama de Flujo">
                    <i class="ri-flow-chart"></i>
                </button>
                
            </div>
            <div class="activity-bar-bottom">
                <button class="activity-button" data-view="settings" title="Configuración">
                    <i class="ri-settings-3-line"></i>
                </button>
            </div>
        </div>

        <!-- Panel lateral -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>EXPLORADOR</h3>
                <div class="sidebar-actions">
                    <button class="action-button" title="Nueva configuración">
                        <i class="ri-add-line"></i>
                    </button>
                    <button class="action-button" title="Actualizar">
                        <i class="ri-refresh-line"></i>
                    </button>
                </div>
            </div>
            <div class="sidebar-content">
                <div class="folder-tree">
                    <!-- Árbol de archivos aquí -->
                </div>
            </div>
        </div>

        <!-- Área principal del editor -->
        <div class="editor-main">
            <div class="editor-tabs">
                <div class="tab active">
                    <span class="tab-icon"><i class="ri-javascript-line"></i></span>
                    <span class="tab-name">main.js</span>
                    <button class="tab-close" title="Cerrar"><i class="ri-close-line"></i></button>
                </div>
            </div>
            <div id="monaco-editor" style="width:100%;height:calc(100% - 35px);"></div>
        </div>

        <!-- Panel de depuración -->
        <div class="debug-panel" style="display: none;">
            <div class="debug-header">
                <h3>DEPURACIÓN</h3>
                <div class="debug-controls">
                    <button class="debug-button" id="continueButton" title="Continuar (F5)">
                        <i class="ri-play-fill"></i>
                    </button>
                    <button class="debug-button" id="stepOverButton" title="Paso a paso por encima (F10)">
                        <i class="ri-arrow-right-s-line"></i>
                    </button>
                    <button class="debug-button" id="stepIntoButton" title="Paso a paso por dentro (F11)">
                        <i class="ri-arrow-down-s-line"></i>
                    </button>
                    <button class="debug-button" id="stepOutButton" title="Paso a paso por fuera (Shift+F11)">
                        <i class="ri-arrow-up-s-line"></i>
                    </button>
                    <button class="debug-button" id="stopButton" title="Detener (Shift+F5)">
                        <i class="ri-stop-fill"></i>
                    </button>
                </div>
            </div>
            <div class="debug-content">
                <div class="debug-section">
                    <h4>Variables</h4>
                    <div id="variablesList" class="debug-list"></div>
                </div>
                <div class="debug-section">
                    <h4>Pila de llamadas</h4>
                    <div id="callStack" class="debug-list"></div>
                </div>
                <div class="debug-section">
                    <h4>Puntos de interrupción</h4>
                    <div id="breakpointsList" class="debug-list"></div>
                </div>
            </div>
        </div>

        <!-- Panel de extensiones -->
        <div class="extensions-panel" style="display: none;">
            <div class="extensions-header">
                <div class="extensions-search">
                    <i class="ri-search-line"></i>
                    <input type="text" placeholder="Buscar extensiones..." class="extensions-input">
                </div>
                <div class="extensions-categories">
                    <button class="category-button active">Recomendadas</button>
                    <button class="category-button">Populares</button>
                    <button class="category-button">Recientes</button>
                </div>
            </div>
            <div class="extensions-list">
                <!-- Las extensiones se cargarán dinámicamente aquí -->
            </div>
        </div>
        <div class="Gemini-panel" style="display: none;">
            <div class="Gemini-header">
                <h3>Gemini</h3>
                <div class="sidebar-actions">
                    <button class="action-button" title="Nueva conversación">
                        <i class="ri-add-line"></i>
                    </button>
                    <button class="action-button" title="Actualizar">
                        <i class="ri-refresh-line"></i>
                    </button>
                    <button class="action-button" title="Eliminar conversación">
                        <i class="ri-delete-bin-line"></i>
                    </button>
                </div>
            </div>
            <div class="Gemini-content">
                <div class="gemini-intro">
                    <div class="gemini-logo">
                        <img src="Sources/Gemini-removebg-preview.png" alt="Gemini Logo"> <!-- Imagen del logo de Gemini -->
                    </div>
                    <h2>¡Hola! Soy Gemini</h2>
                    <p>Tu asistente de programación intel...</p>
                </div>
                <div class="gemini-actions">
                    <button class="action-button-lg">
                        <i class="ri-code-box-line"></i> Generación de código
                    </button>
                    <button class="action-button-lg">
                        <i class="ri-question-line"></i> Respuestas a preguntas
                    </button>
                    <button class="action-button-lg">
                        <i class="ri-bug-line"></i> Depuración de código
                    </button>
                </div>
                <div class="chat-container">
                    <div class="chat-messages" id="gemini-messages">
                        <!-- Los mensajes se agregarán aquí dinámicamente -->
                    </div>
                    <div class="chat-input-container">
                        <textarea class="chat-input" id="gemini-input" placeholder="Escribe un mensaje..."></textarea>
                        <button class="send-button" onclick="sendGeminiMessage()">
                            <i class="ri-send-plane-fill"></i>
                        </button>
                    </div>
                    <div class="suggested-actions">
                        <!-- Acciones sugeridas se agregarán aquí dinámicamente -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel de Copilot -->
        <div class="Copilot-panel" style="display: none;">
            <div class="copilot-content">
                <div class="copilot-header">
                    <div class="copilot-logo">
                        <img src="copilot-logo.png" alt="GitHub Copilot Logo">
                        <span>GitHub Copilot</span>
                    </div>
                    <div class="copilot-header-actions">
                        <button class="copilot-header-button" title="Nueva conversación">
                            <i class="ri-add-line"></i>
                        </button>
                        <button class="copilot-header-button" title="Configuración">
                            <i class="ri-settings-3-line"></i>
                        </button>
                    </div>
                </div>
                <div class="copilot-chat-messages" id="copilot-messages">
                    <div class="copilot-message">
                        <div class="copilot-message-avatar">
                            <i class="ri-copilot-line"></i>
                        </div>
                        <div class="copilot-message-content">
                            <p>¡Hola! Soy GitHub Copilot. ¿En qué puedo ayudarte hoy?</p>
                        </div>
                    </div>
                </div>
                <div class="copilot-suggestions">
                    <div class="copilot-suggestion-item">
                        <div class="copilot-suggestion-icon">
                            <i class="ri-code-box-line"></i>
                        </div>
                        <div class="copilot-suggestion-content">
                            <div class="copilot-suggestion-title">Generar código</div>
                            <div class="copilot-suggestion-description">Sugerencias de código basadas en tu contexto</div>
                        </div>
                    </div>
                    <div class="copilot-suggestion-item">
                        <div class="copilot-suggestion-icon">
                            <i class="ri-question-line"></i>
                        </div>
                        <div class="copilot-suggestion-content">
                            <div class="copilot-suggestion-title">Explicar código</div>
                            <div class="copilot-suggestion-description">Obtén explicaciones detalladas de tu código</div>
                        </div>
                    </div>
                </div>
                <div class="copilot-quick-actions">
                    <button class="copilot-quick-action">
                        <i class="ri-code-box-line"></i> Generar función
                    </button>
                    <button class="copilot-quick-action">
                        <i class="ri-question-line"></i> Explicar código
                    </button>
                    <button class="copilot-quick-action">
                        <i class="ri-bug-line"></i> Depurar
                    </button>
                </div>
                <div class="copilot-chat-input-container">
                    <div class="copilot-chat-input-wrapper">
                        <textarea class="copilot-chat-input" id="copilot-input" placeholder="Escribe un mensaje o describe lo que necesitas..."></textarea>
                        <button class="copilot-send-button" onclick="sendCopilotMessage()">
                            <i class="ri-send-plane-fill"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel de estado -->
        <div class="status-bar">
            <div class="status-left">
                <span class="status-item"><i class="ri-git-branch-line"></i> main</span>
                <span class="status-item"><i class="ri-error-warning-line"></i> 0 <i class="ri-close-circle-line"></i> 0</span>
            </div>
            <div class="status-right">
                <span class="status-item">UTF-8</span>
                <span class="status-item">JavaScript</span>
                <span class="status-item">Espacios: 4</span>
                <span class="status-item">Ln 1, Col 1</span>
            </div>
        </div>
    </div>

    <!-- Monaco Editor Script -->
    <script>var require = { paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' } };</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/editor/editor.main.nls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/editor/editor.main.js"></script>

    <script>


        // Agregar variable para la vista actual
        let currentView = 'explorer';

        // Definir la función changeTheme globalmente
        window.changeTheme = function(theme) {
            if (window.monaco && window.editor) {
                try {
                    // Aplicar el tema al editor
                    monaco.editor.setTheme(theme);
                    
                    // Actualizar el fondo del editor según el tema
                    const editorElement = document.getElementById('monaco-editor');
                    const editorContainer = editorElement.parentElement;
                    const editorMain = document.querySelector('.editor-main');
                    
                    switch(theme) {
                        case 'vs':
                            editorElement.style.backgroundColor = '#ffffff';
                            editorContainer.style.backgroundColor = '#ffffff';
                            editorMain.style.backgroundColor = '#ffffff';
                            document.body.style.backgroundColor = '#ffffff';
                            break;
                        case 'vs-dark':
                            editorElement.style.backgroundColor = '#1e1e1e';
                            editorContainer.style.backgroundColor = '#1e1e1e';
                            editorMain.style.backgroundColor = '#1e1e1e';
                            document.body.style.backgroundColor = '#1e1e1e';
                            break;
                        case 'hc-black':
                            editorElement.style.backgroundColor = '#000000';
                            editorContainer.style.backgroundColor = '#000000';
                            editorMain.style.backgroundColor = '#000000';
                            document.body.style.backgroundColor = '#000000';
                            break;
                        case 'monokai':
                            editorElement.style.backgroundColor = '#272822';
                            editorContainer.style.backgroundColor = '#272822';
                            editorMain.style.backgroundColor = '#272822';
                            document.body.style.backgroundColor = '#272822';
                            break;
                        case 'github':
                            editorElement.style.backgroundColor = '#ffffff';
                            editorContainer.style.backgroundColor = '#ffffff';
                            editorMain.style.backgroundColor = '#ffffff';
                            document.body.style.backgroundColor = '#ffffff';
                            break;
                    }

                    // Forzar una actualización del layout del editor
                    window.editor.layout();
                    
                    console.log('Tema cambiado a:', theme);
                } catch (error) {
                    console.error('Error al cambiar el tema:', error);
                }
            }
            
            // Cerrar el menú de configuración
            if (window.settingsMenu) {
                window.settingsMenu.remove();
                window.settingsMenu = null;
            }
        }

        // Función para mostrar/ocultar el menú de configuración
        function toggleSettingsMenu() {
            if (window.settingsMenu) {
                window.settingsMenu.remove();
                window.settingsMenu = null;
                return;
            }

            window.settingsMenu = document.createElement('div');
            window.settingsMenu.className = 'settings-menu';
            window.settingsMenu.innerHTML = `
                <h3>Configuración</h3>
                <div class="theme-selector">
                    <h4>Tema</h4>
                    <button onclick="window.changeTheme('vs')">Claro</button>
                    <button onclick="window.changeTheme('vs-dark')">Oscuro</button>
                    <button onclick="window.changeTheme('hc-black')">Alto Contraste</button>
                    <button onclick="window.changeTheme('monokai')">Monokai</button>
                    <button onclick="window.changeTheme('github')">GitHub</button>
                    <button onclick="window.changeTheme('githubDark')">GitHub Dark</button>
                </div>
            `;
            document.body.appendChild(window.settingsMenu);

            // Cerrar el menú al hacer clic fuera
            document.addEventListener('click', function closeSettingsMenu(e) {
                if (!window.settingsMenu.contains(e.target) && !e.target.closest('[data-view="settings"]')) {
                    window.settingsMenu.remove();
                    window.settingsMenu = null;
                    document.removeEventListener('click', closeSettingsMenu);
                }
            });
        }

        // Función para inicializar el editor
        function initEditor() {
            require(['vs/editor/editor.main'], function() {
                // Definir temas personalizados
                const monokaiTheme = {
                    base: 'vs-dark',
                    inherit: true,
                    rules: [
                        { token: '', foreground: 'f8f8f2', background: '272822' },
                        { token: 'comment', foreground: '75715e' },
                        { token: 'string', foreground: 'e6db74' },
                        { token: 'variable', foreground: 'f8f8f2' },
                        { token: 'number', foreground: 'ae81ff' },
                        { token: 'keyword', foreground: 'f92672' },
                        { token: 'delimiter', foreground: 'f8f8f2' },
                        { token: 'type', foreground: '66d9ef' },
                        { token: 'function', foreground: 'a6e22e' }
                    ],
                    colors: {
                        'editor.background': '#272822',
                        'editor.foreground': '#f8f8f2',
                        'editor.lineHighlightBackground': '#3e3d32',
                        'editorCursor.foreground': '#f8f8f0',
                        'editorWhitespace.foreground': '#3b3a32',
                        'editor.lineHighlightBorder': '#3e3d32',
                        'editor.selectionBackground': '#49483e',
                        'editor.inactiveSelectionBackground': '#49483e'
                    }
                };

                const githubTheme = {
                    base: 'vs',
                    inherit: true,
                    rules: [
                        { token: '', foreground: 'f8f8f2', background: '272822' },
                        { token: 'comment', foreground: '6a737d' },
                        { token: 'string', foreground: '79b8ff' },
                        { token: 'variable', foreground: 'ff7b72' },
                        { token: 'number', foreground: '79b8ff' },
                        { token: 'keyword', foreground: 'ff7b72' },
                        { token: 'delimiter', foreground: 'f8f8f2' },
                        { token: 'type', foreground: '79b8ff' },
                        { token: 'function', foreground: 'b392f0' },
                        { token: 'operator', foreground: 'ff7b72' },
                        { token: 'property', foreground: '79b8ff' },
                        { token: 'parameter', foreground: 'ff7b72' },
                        { token: 'class', foreground: 'b392f0' },
                        { token: 'interface', foreground: 'b392f0' },
                        { token: 'enum', foreground: 'b392f0' },
                        { token: 'constant', foreground: '79b8ff' },
                        { token: 'console', foreground: 'ff7b72' },
                        { token: 'log', foreground: 'b392f0' },
                        { token: 'debug', foreground: '79b8ff' },
                        { token: 'info', foreground: '79b8ff' },
                        { token: 'warn', foreground: 'ffa657' },
                        { token: 'error', foreground: 'f85149' },
                        { token: 'variable.declaration', foreground: 'ff7b72' },
                        { token: 'variable.readonly', foreground: '79b8ff' },
                        { token: 'variable.parameter', foreground: 'ff7b72' }
                    ],
                    colors: {
                        'editor.background': '#0d1117',
                        'editor.foreground': '#c9d1d9',
                        'editor.lineHighlightBackground': '#161b22',
                        'editorCursor.foreground': '#c9d1d9',
                        'editorWhitespace.foreground': '#161b22',
                        'editor.lineHighlightBorder': '#161b22',
                        'editor.selectionBackground': '#264f78',
                        'editor.inactiveSelectionBackground': '#264f78',
                        'editorMinimap.background': 'transparent',
                    }
                };

                // Registrar los temas
                monaco.editor.defineTheme('monokai', monokaiTheme);
                monaco.editor.defineTheme('github', githubTheme);

                // Crear el editor
                const editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                    value: `// Escribe tu código aquí\n\nconst frasesMotivadoras = [\n  "¡Ponte trucha, que el mundo no espera!",\n  "El éxito no se duerme, y tú tampoco deberías.",\n  "Echa chingazos, no excusas.",\n  "Código duro o nada, prro.",\n  "No le saques, que pa' eso estás hecho.",\n  "Levántate, compila y domina el día.",\n  "Tu futuro no se va a programar solo, carnal."\n];`,
                    language: 'javascript',
                    theme: 'vs-dark',
                    automaticLayout: true,
                    minimap: { enabled: true },
                    fontSize: 14,
                    fontFamily: "'Fira Code', monospace",
                    lineNumbers: 'on',
                    roundedSelection: false,
                    scrollBeyondLastLine: false,
                    readOnly: false,
                    cursorStyle: 'line',
                    cursorBlinking: 'smooth',
                    cursorSmoothCaretAnimation: true,
                    cursorWidth: 2,
                    contextmenu: true,
                    mouseWheelZoom: true,
                    scrollbar: {
                        vertical: 'visible',
                        horizontal: 'visible',
                        useShadows: false,
                        verticalScrollbarSize: 10,
                        horizontalScrollbarSize: 10
                    }
                });

                window.editor = editor;
                window.monaco = monaco;

                // Actualizar la posición del cursor en la barra de estado
                editor.onDidChangeCursorPosition((e) => {
                    const position = e.position;
                    document.querySelector('.status-item:last-child').textContent =
                        `Ln ${position.lineNumber}, Col ${position.column}`;
                });

                // Inicializar la vista por defecto
                changeView('explorer');
                
                // Ocultar el panel de depuración al inicio
                const debugPanel = document.querySelector('.debug-panel');
                if (debugPanel) {
                    debugPanel.style.display = 'none';
                }
            });
        }

       
        
            window.addEventListener('DOMContentLoaded', () => {
                initEditor();
            });


        // Función para cambiar la vista
        function changeView(view) {
            currentView = view;
            document.querySelectorAll('.activity-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            const sidebar = document.querySelector('.sidebar');
            const sidebarHeader = document.querySelector('.sidebar-header h3');
            const extensionsPanel = document.querySelector('.extensions-panel');
            const debugPanel = document.querySelector('.debug-panel');
            const geminiPanel = document.querySelector('.Gemini-panel');
            const copilot = document.querySelector('.Copilot-panel');
            
            // Ocultar todos los paneles primero
            if (extensionsPanel) extensionsPanel.style.display = 'none';
            if (debugPanel) debugPanel.style.display = 'none';
            if (geminiPanel) geminiPanel.style.display = 'none';
            if (copilot) copilot.style.display = 'none';
            
            switch(view) {
                case 'explorer':
                    sidebar.style.display = 'block';
                    sidebarHeader.textContent = 'EXPLORADOR';
                    sidebar.querySelector('.sidebar-content').innerHTML = `
                        <div class="folder-tree">
                            <!-- Árbol de archivos aquí -->
                        </div>
                    `;
                    break;
                case 'search':
                    sidebar.style.display = 'block';
                    sidebarHeader.textContent = 'BUSCAR';
                    sidebar.querySelector('.sidebar-content').innerHTML = `
                        <div class="search-container">
                            <!-- Búsqueda aquí -->
                        </div>
                    `;
                    break;
                case 'git':
                    sidebar.style.display = 'block';
                    sidebarHeader.textContent = 'CONTROL DE CÓDIGO FUENTE';
                    sidebar.querySelector('.sidebar-content').innerHTML = `
                        <div class="git-container">
                            <!-- Git aquí -->
                        </div>
                    `;
                    break;
                case 'debug':
                    sidebar.style.display = 'block';
                    debugPanel.style.display = 'block';
                    sidebarHeader.textContent = 'EJECUTAR Y DEPURAR';
                    sidebar.querySelector('.sidebar-content').innerHTML = `
                        <div class="debug-config">
                            <div class="config-item">
                                <div class="config-header">
                                    <i class="ri-play-circle-line"></i>
                                    <span>Ejecutar</span>
                                </div>
                                <div class="config-actions">
                                    <button class="config-button" onclick="runCode()">
                                        <i class="ri-play-fill"></i>
                                        Ejecutar
                                    </button>
                                </div>
                            </div>
                            <div class="config-item">
                                <div class="config-header">
                                    <i class="ri-bug-line"></i>
                                    <span>Depurar</span>
                                </div>
                                <div class="config-actions">
                                    <button class="config-button" onclick="startDebugging()">
                                        <i class="ri-bug-fill"></i>
                                        Iniciar Depuración
                                    </button>
                                </div>
                            </div>
                            <div class="config-item">
                                <div class="config-header">
                                    <i class="ri-settings-3-line"></i>
                                    <span>Configuración</span>
                                </div>
                                <div class="config-actions">
                                    <button class="config-button" onclick="toggleBreakpoints()">
                                        <i class="ri-checkbox-blank-circle-line"></i>
                                        Puntos de Interrupción
                                    </button>
                                    <button class="config-button" onclick="toggleVariables()">
                                        <i class="ri-code-box-line"></i>
                                        Variables
                                    </button>
                                    <button class="config-button" onclick="toggleCallStack()">
                                        <i class="ri-stack-line"></i>
                                        Pila de Llamadas
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'extensions':
                    sidebar.style.display = 'none';
                    extensionsPanel.style.display = 'block';
                    loadExtensions();
                    break;
                case 'gemini':
                    sidebar.style.display = 'block';
                    sidebarHeader.textContent = 'GEMINI';
                    if (geminiPanel) geminiPanel.style.display = 'flex';
                    // Rellenar el contenido del sidebar con los botones y chat de Gemini
                    sidebar.querySelector('.sidebar-content').innerHTML = `
                        <div class="gemini-intro">
                            <div class="gemini-logo">
                                <img src="Sources/Gemini-removebg-preview.png" alt="Gemini Logo">
                            </div>
                            <h2>¡Hola! Soy Gemini</h2>
                            <p>Tu asistente de programación inteligente.</p>
                        </div>
                        <div class="gemini-actions">
                            <button class="action-button-lg"><i class="ri-code-box-line"></i> Generación de código</button>
                            <button class="action-button-lg"><i class="ri-question-line"></i> Respuestas a preguntas</button>
                            <button class="action-button-lg"><i class="ri-bug-line"></i> Depuración de código</button>
                        </div>
                        <div class="chat-container">
                            <div class="chat-messages" id="gemini-messages"></div>
                            <div class="chat-input-container">
                                <textarea class="chat-input" id="gemini-input" placeholder="Escribe un mensaje..."></textarea>
                                <button class="send-button" onclick="sendGeminiMessage()"><i class="ri-send-plane-fill"></i></button>
                            </div>
                            <div class="suggested-actions"></div>
                        </div>
                    `;
                    break;
                case 'copilot':
                    sidebar.style.display = 'block';
                    sidebarHeader.textContent = 'COPILOT';
                    if (copilot) copilot.style.display = 'flex';
                    sidebar.querySelector('.sidebar-content').innerHTML = `
                        <div class="copilot-content">
                            <div class="copilot-header">
                                <div class="copilot-logo">
                                    <img src="copilot-logo.png" alt="GitHub Copilot Logo">
                                    <span>GitHub Copilot</span>
                                </div>
                                <div class="copilot-header-actions">
                                    <button class="copilot-header-button" title="Nueva conversación">
                                        <i class="ri-add-line"></i>
                                    </button>
                                    <button class="copilot-header-button" title="Configuración">
                                        <i class="ri-settings-3-line"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="copilot-chat-messages" id="copilot-messages">
                                <div class="copilot-message">
                                    <div class="copilot-message-avatar">
                                        <i class="ri-copilot-line"></i>
                                    </div>
                                    <div class="copilot-message-content">
                                        <p>¡Hola! Soy GitHub Copilot. ¿En qué puedo ayudarte hoy?</p>
                                    </div>
                                </div>
                            </div>
                            <div class="copilot-suggestions">
                                <div class="copilot-suggestion-item">
                                    <div class="copilot-suggestion-icon">
                                        <i class="ri-code-box-line"></i>
                                    </div>
                                    <div class="copilot-suggestion-content">
                                        <div class="copilot-suggestion-title">Generar código</div>
                                        <div class="copilot-suggestion-description">Sugerencias de código basadas en tu contexto</div>
                                    </div>
                                </div>
                                <div class="copilot-suggestion-item">
                                    <div class="copilot-suggestion-icon">
                                        <i class="ri-question-line"></i>
                                    </div>
                                    <div class="copilot-suggestion-content">
                                        <div class="copilot-suggestion-title">Explicar código</div>
                                        <div class="copilot-suggestion-description">Obtén explicaciones detalladas de tu código</div>
                                    </div>
                                </div>
                            </div>
                            <div class="copilot-quick-actions">
                                <button class="copilot-quick-action">
                                    <i class="ri-code-box-line"></i> Generar función
                                </button>
                                <button class="copilot-quick-action">
                                    <i class="ri-question-line"></i> Explicar código
                                </button>
                                <button class="copilot-quick-action">
                                    <i class="ri-bug-line"></i> Depurar
                                </button>
                            </div>
                            <div class="copilot-chat-input-container">
                                <div class="copilot-chat-input-wrapper">
                                    <textarea class="copilot-chat-input" id="copilot-input" placeholder="Escribe un mensaje o describe lo que necesitas..."></textarea>
                                    <button class="copilot-send-button" onclick="sendCopilotMessage()">
                                        <i class="ri-send-plane-fill"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                default:
                    sidebar.style.display = 'none';
            }
        }

        // Función para cargar extensiones
        function loadExtensions() {
            const extensionsList = document.querySelector('.extensions-list');
            const category = document.querySelector('.category-button.active').textContent.toLowerCase();
            
            // Datos de ejemplo para las extensiones
            const extensions = [
                {
                    publisher: 'ms-python',
                    name: 'python',
                    displayName: 'Python',
                    description: 'Linting, Debugging, IntelliSense, code formatting, refactoring, and more.',
                    version: '2023.11.0',
                    statistics: {
                        installs: 50000000,
                        rating: 4.8
                    }
                },
                {
                    publisher: 'ms-vscode',
                    name: 'cpptools',
                    displayName: 'C/C++',
                    description: 'C/C++ IntelliSense, debugging, and code browsing.',
                    version: '1.15.0',
                    statistics: {
                        installs: 30000000,
                        rating: 4.7
                    }
                },
                {
                    publisher: 'eamodio',
                    name: 'gitlens',
                    displayName: 'GitLens',
                    description: 'Supercharge Git within VS Code.',
                    version: '12.0.0',
                    statistics: {
                        installs: 20000000,
                        rating: 4.9
                    }
                }
            ];

            // Filtrar por categoría
            let filteredExtensions = [...extensions];
            switch(category) {
                case 'popular':
                    filteredExtensions.sort((a, b) => b.statistics.installs - a.statistics.installs);
                    break;
                case 'recent':
                    filteredExtensions.sort((a, b) => b.version.localeCompare(a.version));
                    break;
                case 'recommended':
                    filteredExtensions.sort((a, b) => b.statistics.rating - a.statistics.rating);
                    break;
            }

            extensionsList.innerHTML = filteredExtensions.map(extension => `
                <div class="extension-card">
                    <div class="extension-icon">
                        <i class="ri-code-box-line"></i>
                    </div>
                    <div class="extension-info">
                        <h3>${extension.displayName}</h3>
                        <p class="publisher">${extension.publisher}</p>
                        <p class="description">${extension.description}</p>
                        <div class="extension-stats">
                            <span><i class="ri-download-line"></i> ${formatNumber(extension.statistics.installs)}</span>
                            <span><i class="ri-star-fill"></i> ${extension.statistics.rating}</span>
                        </div>
                    </div>
                    <button class="install-button" onclick="installExtension('${extension.publisher}', '${extension.name}', '${extension.version}')">
                        Instalar
                    </button>
                </div>
            `).join('');

            // Agregar event listeners a los botones de categoría
            document.querySelectorAll('.category-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    loadExtensions();
                });
            });

            // Agregar event listener al campo de búsqueda
            const searchInput = document.querySelector('.extensions-input');
            searchInput.addEventListener('input', debounce((e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = extensions.filter(ext => 
                    ext.displayName.toLowerCase().includes(searchTerm) ||
                    ext.description.toLowerCase().includes(searchTerm)
                );
                extensionsList.innerHTML = filtered.map(extension => `
                    <div class="extension-card">
                        <div class="extension-icon">
                            <i class="ri-code-box-line"></i>
                        </div>
                        <div class="extension-info">
                            <h3>${extension.displayName}</h3>
                            <p class="publisher">${extension.publisher}</p>
                            <p class="description">${extension.description}</p>
                            <div class="extension-stats">
                                <span><i class="ri-download-line"></i> ${formatNumber(extension.statistics.installs)}</span>
                                <span><i class="ri-star-fill"></i> ${extension.statistics.rating}</span>
                            </div>
                        </div>
                        <button class="install-button" onclick="installExtension('${extension.publisher}', '${extension.name}', '${extension.version}')">
                            Instalar
                        </button>
                    </div>
                `).join('');
            }, 300));
        }

        // Función para instalar extensiones
        function installExtension(publisher, name, version) {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Instalando...';
            
            // Simular instalación
            setTimeout(() => {
                button.textContent = 'Instalada';
                button.classList.add('installed');
            }, 1000);
        }

        // Función para formatear números
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Función debounce para la búsqueda
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Agregar event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Botones de actividad
            document.querySelectorAll('.activity-button').forEach(button => {
                button.addEventListener('click', () => {
                    const view = button.getAttribute('data-view');
                    if (view === 'settings') {
                        toggleSettingsMenu();
                    } else {
                        changeView(view);
                    }
                });
            });

            // Botón de cerrar pestaña
            const tabClose = document.querySelector('.tab-close');
            if (tabClose) {
                tabClose.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const tab = e.target.closest('.tab');
                    if (tab) {
                        tab.remove();
                    }
                });
            }
        });

        // Funciones de depuración mejoradas
        let isDebugging = false;
        let breakpoints = new Set();
        let debugPanels = {
            breakpoints: true,
            variables: true,
            callStack: true
        };

        function toggleBreakpoints() {
            debugPanels.breakpoints = !debugPanels.breakpoints;
            updateDebugPanels();
        }

        function toggleVariables() {
            debugPanels.variables = !debugPanels.variables;
            updateDebugPanels();
        }

        function toggleCallStack() {
            debugPanels.callStack = !debugPanels.callStack;
            updateDebugPanels();
        }

        function updateDebugPanels() {
            const debugPanel = document.querySelector('.debug-panel');
            if (!debugPanel) return;

            const sections = debugPanel.querySelectorAll('.debug-section');
            sections.forEach(section => {
                const type = section.querySelector('h4').textContent.toLowerCase();
                if (type.includes('puntos')) {
                    section.style.display = debugPanels.breakpoints ? 'block' : 'none';
                } else if (type.includes('variables')) {
                    section.style.display = debugPanels.variables ? 'block' : 'none';
                } else if (type.includes('pila')) {
                    section.style.display = debugPanels.callStack ? 'block' : 'none';
                }
            });
        }

        function runCode() {
            if (currentView !== 'debug') {
                changeView('debug');
            }
            
            const code = window.editor.getValue();
            const debugContent = document.querySelector('.debug-content');
            
            // Limpiar resultados anteriores
            debugContent.innerHTML = `
                <div class="debug-section">
                    <h4>Consola</h4>
                    <div class="console-container"></div>
                </div>
            `;
            
            const consoleContainer = debugContent.querySelector('.console-container');
            
            // Guardar la función console.log original
            const originalConsoleLog = console.log;
            const originalConsoleError = console.error;
            
            // Sobrescribir console.log para capturar la salida
            console.log = function(...args) {
                const output = document.createElement('div');
                output.className = 'console-output';
                output.textContent = args.map(arg => {
                    if (typeof arg === 'object') {
                        return JSON.stringify(arg, null, 2);
                    }
                    return String(arg);
                }).join(' ');
                consoleContainer.appendChild(output);
                originalConsoleLog.apply(console, args);
            };
            
            // Sobrescribir console.error para capturar errores
            console.error = function(...args) {
                const output = document.createElement('div');
                output.className = 'console-error';
                output.textContent = args.map(arg => {
                    if (typeof arg === 'object') {
                        return JSON.stringify(arg, null, 2);
                    }
                    return String(arg);
                }).join(' ');
                consoleContainer.appendChild(output);
                originalConsoleError.apply(console, args);
            };
            
            try {
                // Crear un contexto aislado para ejecutar el código
                const context = {
                    console: console,
                    setTimeout: setTimeout,
                    setInterval: setInterval,
                    clearTimeout: clearTimeout,
                    clearInterval: clearInterval,
                    Math: Math,
                    Date: Date,
                    JSON: JSON,
                    Array: Array,
                    Object: Object,
                    String: String,
                    Number: Number,
                    Boolean: Boolean,
                    RegExp: RegExp,
                    Error: Error,
                    Promise: Promise
                };
                
                // Ejecutar el código en el contexto aislado
                const wrappedCode = `
                    (function() {
                        try {
                            ${code}
                        } catch (error) {
                            console.error(error);
                        }
                    })();
                `;
                
                const runFunction = new Function(...Object.keys(context), wrappedCode);
                runFunction(...Object.values(context));
                
            } catch (error) {
                console.error('Error al ejecutar el código:', error);
            } finally {
                // Restaurar las funciones originales de console
                console.log = originalConsoleLog;
                console.error = originalConsoleError;
            }
        }

        function startDebugging() {
            if (currentView !== 'debug') {
                changeView('debug');
            }
            
            if (isDebugging) return;
            
            isDebugging = true;
            const debugPanel = document.querySelector('.debug-panel');
            if (debugPanel) {
                debugPanel.style.display = 'block';
            }
            
            const code = window.editor.getValue();
            const lines = code.split('\n');
            
            // Agregar puntos de interrupción
            lines.forEach((line, index) => {
                if (breakpoints.has(index + 1)) {
                    console.log(`Punto de interrupción en línea ${index + 1}`);
                }
            });
            
            // Simular ejecución paso a paso
            let currentLine = 0;
            
            function executeStep() {
                if (currentLine < lines.length) {
                    try {
                        // Ejecutar línea actual
                        const line = lines[currentLine];
                        if (line.trim()) {
                            new Function(line)();
                        }
                        
                        // Actualizar UI
                        updateDebugUI(currentLine + 1);
                        
                        // Resaltar línea actual en el editor
                        window.editor.deltaDecorations([], [{
                            range: new monaco.Range(currentLine + 1, 1, currentLine + 1, 1),
                            options: {
                                isWholeLine: true,
                                className: 'debug-line-highlight'
                            }
                        }]);
                        
                        currentLine++;
                        if (isDebugging) {
                            setTimeout(executeStep, 1000); // Pausa de 1 segundo entre líneas
                        }
                    } catch (error) {
                        console.error('Error en línea', currentLine + 1, ':', error);
                        isDebugging = false;
                        
                        // Mostrar error en la consola
                        const consoleError = document.createElement('div');
                        consoleError.className = 'console-error';
                        consoleError.textContent = `Error en línea ${currentLine + 1}: ${error.message}`;
                        document.querySelector('.debug-content').appendChild(consoleError);
                    }
                } else {
                    isDebugging = false;
                }
            }
            
            executeStep();
        }

        function updateDebugUI(currentLine) {
            // Actualizar lista de variables
            const variablesList = document.getElementById('variablesList');
            variablesList.innerHTML = `
                <div class="debug-item">
                    <span class="debug-label">currentLine:</span>
                    <span class="debug-value">${currentLine}</span>
                </div>
            `;
            
            // Actualizar pila de llamadas
            const callStack = document.getElementById('callStack');
            callStack.innerHTML = `
                <div class="debug-item">
                    <span class="debug-label">Línea ${currentLine}</span>
                </div>
            `;
        }

        function toggleBreakpoint(lineNumber) {
            if (breakpoints.has(lineNumber)) {
                breakpoints.delete(lineNumber);
            } else {
                breakpoints.add(lineNumber);
            }
            updateBreakpointsList();
        }

        function updateBreakpointsList() {
            const breakpointsList = document.getElementById('breakpointsList');
            breakpointsList.innerHTML = Array.from(breakpoints).map(line => `
                <div class="debug-item">
                    <span class="debug-label">Línea ${line}</span>
                    <button class="debug-remove" onclick="toggleBreakpoint(${line})">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
            `).join('');
        }

        // Event listeners para los botones de depuración
        // document.getElementById('runButton').addEventListener('click', runCode); // Comentado porque el elemento con ID runButton no existe
        // document.getElementById('debugButton').addEventListener('click', startDebugging); // Comentado porque el elemento con ID debugButton no existe
        document.getElementById('continueButton').addEventListener('click', () => {
            if (!isDebugging) startDebugging();
        });
        document.getElementById('stopButton').addEventListener('click', () => {
            isDebugging = false;
            const debugPanel = document.querySelector('.debug-panel');
            if (debugPanel) {
                debugPanel.style.display = 'none';
            }
        });

        // Event listener para agregar puntos de interrupción
        window.editor.onMouseDown((e) => {
            if (e.event.altKey) {
                const position = e.target.position;
                if (position) {
                    toggleBreakpoint(position.lineNumber);
                }
            }
        });
    </script>
</body>
</html>

